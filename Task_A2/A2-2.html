<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v7.min.js"></script>

<!-- Create an SVG element -->
<svg id="visualization" width="800" height="600"></svg>

<script>
    // Load Airbnb dataset
    d3.csv("http://127.0.0.1:5500/Task_A2/AB_NYC_2019.csv").then(function(data) {
        // Count occurrences of each room_type
        const countByRoomType = d3.rollup(data, v => v.length, d => d.room_type);

        // Set up SVG
        const svg = d3.select("#visualization");

        // Define color scale
        const colorScale = d3.scaleOrdinal(d3.schemeCategory10);

        // Define pie generator
        const pie = d3.pie()
            .value(function(d) { return d[1]; });

        // Generate pie data
        const pieData = pie(countByRoomType.entries());

        // Define arc generator
        const arc = d3.arc()
            .innerRadius(0)
            .outerRadius(150);

        // Draw pie chart
        svg.selectAll("path")
            .data(pieData)
            .enter()
            .append("path")
            .attr("d", arc)
            .attr("fill", function(d, i) { return colorScale(i); })
            .attr("transform", "translate(300, 300)");
        
        // Add percentages
        svg.selectAll("text")
            .data(pieData)
            .enter()
            .append("text")
            .text(function(d) {
                const percentage = (d.endAngle - d.startAngle) / (2 * Math.PI) * 100;
                return percentage.toFixed(1) + "%";
            })
            .attr("transform", function(d) {
                const pos = arc.centroid(d);
                return "translate(" + (pos[0] + 300) + "," + (pos[1] + 300) + ")";
            })
            .attr("text-anchor", "middle")
            .attr("alignment-baseline", "middle")
            .style("fill", "black")
            .style("font-size", "12px");
        
        // Add legend
        const legend = svg.selectAll(".legend")
            .data(pieData)
            .enter()
            .append("g")
            .attr("class", "legend")
            .attr("transform", function(d, i) { return "translate(500," + (50 + i * 20) + ")"; });

        legend.append("rect")
            .attr("x", 0)
            .attr("width", 10)
            .attr("height", 10)
            .attr("fill", function(d, i) { return colorScale(i); });

        legend.append("text")
            .attr("x", 20)
            .attr("y", 5)
            .text(function(d) { return d.data[0]; });
    });
</script>

